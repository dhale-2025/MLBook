
---
title: "Feedforward Neural Network - Python"
format:
  html:
    code-fold: false
  pdf:
    toc: true
jupyter: python3
---

## Feedforward Neural Network (MLP) Using Ames Housing (Python)

This chapter fits a feed-forward neural network to the Ame Housing subset used in the R version.  
RMSE is computed manually for compatibility with older scikit-learn versions.

---

### 1. Load and Prepare Data

```{python}
import numpy as np
import pandas as pd

from sklearn.datasets import fetch_openml
from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.preprocessing import StandardScaler
from sklearn.neural_network import MLPRegressor
from sklearn.metrics import mean_squared_error

np.random.seed(12345)

ames = fetch_openml(name="house_prices", as_frame=True)
df = ames.frame

selected_cols = [
    "SalePrice","BedroomAbvGr","YearBuilt","MoSold","LotArea",
    "Street","CentralAir","1stFlrSF","2ndFlrSF","FullBath",
    "HalfBath","Fireplaces","GarageArea","GrLivArea","TotRmsAbvGrd"
]

df_sub = df[selected_cols].dropna()
df_sub = pd.get_dummies(df_sub, columns=["Street","CentralAir"], drop_first=True)

y = df_sub["SalePrice"]
X = df_sub.drop("SalePrice", axis=1)
```

---

### 2. Train/Test Split & Scaling

```{python}
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=12345
)

scaler = StandardScaler()
scaler.fit(X_train)

X_train_s = scaler.transform(X_train)
X_test_s = scaler.transform(X_test)
```

---

### 3. Simple MLP Model

```{python}
nn_simple = MLPRegressor(
    solver="lbfgs",
    alpha=1e-5,
    hidden_layer_sizes=(5,),
    random_state=12345,
    max_iter=5000
)

nn_simple.fit(X_train_s, y_train)
pred_simple = nn_simple.predict(X_test_s)

rmse_simple = mean_squared_error(y_test, pred_simple) ** 0.5
rmse_simple
```

---

### 4. Grid Search Tuning

```{python}
param_grid = {
    "hidden_layer_sizes": [(h,) for h in [3,4,5,6,7]],
    "alpha": [0.00005,0.0005],
    "solver": ["lbfgs"]
}

nn_base = MLPRegressor(max_iter=5000, random_state=12345)

grid = GridSearchCV(
    estimator=nn_base,
    param_grid=param_grid,
    cv=10,
    scoring="neg_mean_squared_error",
    n_jobs=-1
)

grid.fit(X_train_s, y_train)

grid.best_params_
```

```{python}
best_model = grid.best_estimator_
pred_gs = best_model.predict(X_test_s)

rmse_gs = mean_squared_error(y_test, pred_gs) ** 0.5
rmse_gs
```
