{
  "hash": "fe04e3fa117ecda8a24aab66da7eebc9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"GAM – Piecewise, MARS, LOESS, and Splines - R Version\"\nformat:\n  html:\n    toc: true\n    number-sections: true\n  pdf: default\n---\n\n> **Goal:** Predict `Sale_Price` from a focused set of Ames features using increasingly flexible methods in the GAM framework.\n\n## 1. Setup and Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4321)\n\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(AmesHousing)   # make_ordinal_ames()\nlibrary(earth)         # MARS\nlibrary(segmented)     # piecewise (segmented) regression\nlibrary(splines)       # regression splines (bs, ns) - kept for reference\nlibrary(mgcv)          # smoothing splines via GAM\nlibrary(caret)         # data splitting / utilities\nlibrary(Metrics)       # rmse, mse helpers (plus we'll compute R2 manually)\ntheme_set(theme_minimal())\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Limit to requested columns\ncols <- c(\"Sale_Price\",\"Bedroom_AbvGr\",\"Year_Built\",\"Mo_Sold\",\"Lot_Area\",\"Street\",\n          \"Central_Air\",\"First_Flr_SF\",\"Second_Flr_SF\",\"Full_Bath\",\"Half_Bath\",\n          \"Fireplaces\",\"Garage_Area\",\"Gr_Liv_Area\",\"TotRms_AbvGrd\")\n\names <- make_ordinal_ames() |> \n  dplyr::select(dplyr::all_of(cols)) |> \n  tidyr::drop_na()\n\n# Train/test split\nset.seed(4321)\nidx <- sample.int(nrow(ames), size = floor(0.7*nrow(ames)))\ntrain <- ames[idx,]\ntest  <- ames[-idx,]\n\nglimpse(train)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 2,051\nColumns: 15\n$ Sale_Price    <int> 274000, 75200, 329900, 145400, 108000, 184000, 176000, 1…\n$ Bedroom_AbvGr <int> 3, 2, 4, 3, 2, 2, 3, 3, 3, 3, 3, 3, 3, 4, 3, 2, 3, 3, 2,…\n$ Year_Built    <int> 2001, 1922, 2005, 1926, 1949, 1999, 1962, 1915, 1999, 19…\n$ Mo_Sold       <int> 1, 9, 8, 5, 5, 6, 5, 6, 9, 6, 8, 5, 7, 7, 4, 8, 5, 11, 5…\n$ Lot_Area      <int> 9720, 3672, 11643, 7000, 8777, 5858, 19296, 8094, 3768, …\n$ Street        <fct> Pave, Pave, Pave, Pave, Pave, Pave, Pave, Pave, Pave, Pa…\n$ Central_Air   <fct> Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y,…\n$ First_Flr_SF  <int> 1366, 816, 1544, 861, 1126, 1337, 1382, 1048, 713, 792, …\n$ Second_Flr_SF <int> 581, 0, 814, 424, 0, 0, 0, 720, 739, 725, 0, 1151, 695, …\n$ Full_Bath     <int> 2, 1, 2, 1, 2, 2, 1, 2, 2, 1, 1, 2, 2, 2, 1, 2, 2, 1, 1,…\n$ Half_Bath     <int> 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0,…\n$ Fireplaces    <int> 1, 0, 1, 0, 0, 1, 1, 0, 0, 2, 0, 1, 2, 1, 0, 1, 0, 0, 1,…\n$ Garage_Area   <dbl> 725, 100, 784, 506, 520, 511, 884, 576, 506, 400, 0, 434…\n$ Gr_Liv_Area   <int> 1947, 816, 2358, 1285, 1126, 1337, 1382, 1768, 1452, 151…\n$ TotRms_AbvGrd <int> 7, 5, 10, 6, 5, 5, 6, 8, 6, 7, 5, 8, 7, 5, 6, 7, 6, 6, 5…\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(train$Sale_Price)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  12789  130000  161000  180897  215000  755000 \n```\n\n\n:::\n:::\n\n\n---\n\n## 2. Quick Visual: Nonlinearity is Common\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(train, aes(Gr_Liv_Area, Sale_Price)) +\n  geom_point(alpha=.3) +\n  geom_smooth(method=\"loess\", se=FALSE) +\n  labs(title=\"Sale_Price vs Gr_Liv_Area (LOESS smoother)\")\n```\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n**Takeaway:** The relationship bends—nonlinear methods can help.\n\n---\n\n## 3. Piecewise Regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_lin <- lm(Sale_Price ~ Gr_Liv_Area, data=train)\nm_seg_init <- lm(Sale_Price ~ Gr_Liv_Area, data=train)\nm_seg <- segmented(m_seg_init, seg.Z = ~ Gr_Liv_Area, psi = list(Gr_Liv_Area = 2000))\nsummary(m_seg)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\t***Regression Model with Segmented Relationship(s)***\n\nCall: \nsegmented.lm(obj = m_seg_init, seg.Z = ~Gr_Liv_Area, psi = list(Gr_Liv_Area = 2000))\n\nEstimated Break-Point(s):\n                  Est.  St.Err\npsi1.Gr_Liv_Area 2466 332.881\n\nCoefficients of the linear terms:\n               Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    7901.186   4698.641   1.682   0.0928 .  \nGr_Liv_Area     115.705      3.171  36.488   <2e-16 ***\nU1.Gr_Liv_Area  -23.479     12.436  -1.888       NA    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 55110 on 2047 degrees of freedom\nMultiple R-Squared: 0.5124,  Adjusted R-squared: 0.5116 \n\nBoot restarting based on 6 samples. Last fit:\nConvergence attained in 1 iterations (rel. change 0)\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(train$Gr_Liv_Area, train$Sale_Price, pch=16, cex=.5,\n     xlab=\"Gr_Liv_Area\", ylab=\"Sale_Price\", main=\"Piecewise fit at estimated knot\")\nplot(m_seg, add=TRUE, col=2, lwd=2)\nabline(v = m_seg$psi[,\"Est.\"], lty=2, col=2)\n```\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n**Interpretation (piecewise):** Two linear slopes before/after a knot. Useful when you expect a threshold effect.\n\n---\n\n## 4. MARS (earth) – From Simple to Interactions\n\nMARS = *Multivariate Adaptive Regression Splines*. It builds **hinge** basis functions like `h(x - c) = max(0, x - c)` and can **interact** them.  \n- A term such as `h(Gr_Liv_Area - 1500)` means *once* `Gr_Liv_Area` exceeds 1500, the fitted line’s slope can change.  \n- An interaction like `h(Gr_Liv_Area - 1500) * Central_AirY` means the slope change applies when `Central_Air == \"Y\"`.\n\n### 4A. Univariate MARS (Garage_Area)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmars1 <- earth(Sale_Price ~ Garage_Area, data=train)\nsummary(mars1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: earth(formula=Sale_Price~Garage_Area, data=train)\n\n                    coefficients\n(Intercept)           124159.039\nh(286-Garage_Area)       -60.257\nh(Garage_Area-286)       297.277\nh(Garage_Area-521)      -483.642\nh(Garage_Area-576)       733.859\nh(Garage_Area-758)      -356.460\nh(Garage_Area-1043)     -490.873\n\nSelected 7 of 7 terms, and 1 of 1 predictors\nTermination condition: RSq changed by less than 0.001 at 7 terms\nImportance: Garage_Area\nNumber of terms at each degree of interaction: 1 6 (additive model)\nGCV 3427475346    RSS 6.94092e+12    GRSq 0.4492014    RSq 0.4556309\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrid <- tibble(Garage_Area = seq(min(train$Garage_Area), max(train$Garage_Area), length.out=200))\ngrid$pred <- predict(mars1, newdata=grid)\n\nggplot(train, aes(Garage_Area, Sale_Price)) +\n  geom_point(alpha=.3) +\n  geom_line(data=grid, aes(Garage_Area, pred), color=\"blue\", linewidth=1.2) +\n  labs(title=\"Step 1: MARS with One Predictor (Garage_Area)\",\n       subtitle=\"Piecewise linear fit with automatically chosen knots\",\n       y=\"Predicted Sale_Price\")\n```\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n### 4B. Additive MARS (degree = 1; no interactions)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmars2 <- earth(Sale_Price ~ Bedroom_AbvGr + Year_Built + Mo_Sold + Lot_Area +\n                 Street + Central_Air + First_Flr_SF + Second_Flr_SF + Full_Bath +\n                 Half_Bath + Fireplaces + Garage_Area + Gr_Liv_Area + TotRms_AbvGrd,\n               data=train, degree=1, nfold=5)\nsummary(mars2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: earth(formula=Sale_Price~Bedroom_AbvGr+Year_Built+Mo_Sold+Lot_Ar...),\n            data=train, degree=1, nfold=5)\n\n                      coefficients\n(Intercept)              319493.46\nCentral_AirY              20289.49\nh(4-Bedroom_AbvGr)         9214.66\nh(Bedroom_AbvGr-4)       -23009.05\nh(Year_Built-1977)         1275.57\nh(2004-Year_Built)         -336.64\nh(Year_Built-2004)         5315.57\nh(13869-Lot_Area)            -2.09\nh(Lot_Area-13869)             0.22\nh(First_Flr_SF-1600)        104.91\nh(2402-First_Flr_SF)        -71.56\nh(First_Flr_SF-2402)       -176.61\nh(1523-Second_Flr_SF)       -53.13\nh(Second_Flr_SF-1523)       426.63\nh(Half_Bath-1)           -45378.31\nh(2-Fireplaces)          -14408.56\nh(Fireplaces-2)          -26072.58\nh(Garage_Area-539)          101.97\nh(Garage_Area-1043)        -294.30\nh(Gr_Liv_Area-2049)          65.21\nh(Gr_Liv_Area-3194)        -159.79\n\nSelected 21 of 24 terms, and 10 of 14 predictors\nTermination condition: Reached nk 29\nImportance: First_Flr_SF, Second_Flr_SF, Year_Built, Garage_Area, ...\nNumber of terms at each degree of interaction: 1 20 (additive model)\nGCV 1033819964  RSS 2.036439e+12  GRSq 0.8338641  RSq 0.8402842  CVRSq 0.7978671\n\nNote: the cross-validation sd's below are standard deviations across folds\n\nCross validation:   nterms 21.00 sd 0.71    nvars 9.20 sd 0.84\n\n     CVRSq    sd     MaxErr     sd\n     0.798 0.043    -428941 282429\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nev2 <- evimp(mars2); plot(ev2, main=\"Step 2: Variable Importance (degree=1, additive)\")\n```\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\npar(mfrow=c(2,2)); plotmo(mars2, type=\"response\", nresponse=1, do.par=FALSE); par(mfrow=c(1,1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n plotmo grid:    Bedroom_AbvGr Year_Built Mo_Sold Lot_Area Street Central_Air\n                             3       1974       6     9480   Pave           Y\n First_Flr_SF Second_Flr_SF Full_Bath Half_Bath Fireplaces Garage_Area\n         1092             0         2         0          1         480\n Gr_Liv_Area TotRms_AbvGrd\n        1442             6\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-9-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-9-4.png){width=672}\n:::\n:::\n\n\n### 4C. MARS with 2-way Interactions (degree = 2)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmars3 <- earth(Sale_Price ~ Bedroom_AbvGr + Year_Built + Mo_Sold + Lot_Area +\n                 Street + Central_Air + First_Flr_SF + Second_Flr_SF + Full_Bath +\n                 Half_Bath + Fireplaces + Garage_Area + Gr_Liv_Area + TotRms_AbvGrd,\n               data=train, degree=2, nfold=5)\nsummary(mars3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: earth(formula=Sale_Price~Bedroom_AbvGr+Year_Built+Mo_Sold+Lot_Ar...),\n            data=train, degree=2, nfold=5)\n\n                                           coefficients\n(Intercept)                                   411949.27\nh(Year_Built-2004)                            169869.37\nh(14803-Lot_Area)                                 -1.75\nh(Lot_Area-14803)                                  0.48\nh(1570-First_Flr_SF)                            -150.79\nh(First_Flr_SF-1570)                             224.90\nh(1523-Second_Flr_SF)                            -86.91\nh(Second_Flr_SF-1523)                            156.02\nh(1-Half_Bath)                                 -7743.19\nh(Half_Bath-1)                                -54819.24\nh(2-Fireplaces)                               -10516.92\nh(1043-Garage_Area)                              -70.97\nh(Garage_Area-1043)                             -141.86\nh(Gr_Liv_Area-3194)                              106.27\nh(3-Bedroom_AbvGr) * h(1523-Second_Flr_SF)         7.01\nh(Bedroom_AbvGr-3) * h(1523-Second_Flr_SF)        -9.61\nh(2004-Year_Built) * h(First_Flr_SF-876)          -1.86\nh(2004-Year_Built) * h(3194-Gr_Liv_Area)          -0.17\nh(Year_Built-2004) * h(Gr_Liv_Area-2320)        -159.80\nh(Year_Built-2004) * h(2320-Gr_Liv_Area)         156.64\nh(Year_Built-2004) * h(3194-Gr_Liv_Area)        -173.05\nh(First_Flr_SF-1778) * h(2-Fireplaces)           -78.19\nh(1043-Garage_Area) * h(2122-Gr_Liv_Area)          0.05\n\nSelected 23 of 29 terms, and 9 of 14 predictors\nTermination condition: Reached nk 29\nImportance: First_Flr_SF, Second_Flr_SF, Year_Built, Gr_Liv_Area, ...\nNumber of terms at each degree of interaction: 1 13 9\nGCV 795873462  RSS 1.544416e+12  GRSq 0.8721024  RSq 0.8788731  CVRSq 0.7824362\n\nNote: the cross-validation sd's below are standard deviations across folds\n\nCross validation:   nterms 22.60 sd 1.82    nvars 9.40 sd 1.14\n\n     CVRSq    sd     MaxErr     sd\n     0.782 0.114    -945502 422348\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nev3 <- evimp(mars3); plot(ev3, main=\"Step 3: Variable Importance (degree=2, interactions)\")\n```\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\npar(mfrow=c(2,2)); plotmo(mars3, type=\"response\", nresponse=1, do.par=FALSE); par(mfrow=c(1,1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n plotmo grid:    Bedroom_AbvGr Year_Built Mo_Sold Lot_Area Street Central_Air\n                             3       1974       6     9480   Pave           Y\n First_Flr_SF Second_Flr_SF Full_Bath Half_Bath Fireplaces Garage_Area\n         1092             0         2         0          1         480\n Gr_Liv_Area TotRms_AbvGrd\n        1442             6\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-11-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-11-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-11-5.png){width=672}\n:::\n:::\n\n\n**Interpreting MARS terms:**  \nLook for `h()` pieces and products. Coefficients on `h(x-c)` indicate how slope changes after the knot `c`. Interaction products mean “the slope change depends on another variable”.\n\n---\n\n## 5. LOESS (Visual local regression)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloess_fit <- loess(Sale_Price ~ Gr_Liv_Area, data=train, span=0.4)\ngrid_lo <- tibble(Gr_Liv_Area = seq(min(train$Gr_Liv_Area), max(train$Gr_Liv_Area), length.out=200))\ngrid_lo$pred <- predict(loess_fit, newdata=grid_lo)\n\nggplot() +\n  geom_point(data=train, aes(Gr_Liv_Area, Sale_Price), alpha=.25) +\n  geom_line(data=grid_lo, aes(Gr_Liv_Area, pred), linewidth=1.2) +\n  labs(title=\"LOESS fit (span=0.4)\", y=\"Predicted Sale_Price\")\n```\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n*We keep LOESS as a visualization-oriented smoother (not used in the multivariate comparison below).*\n\n---\n\n## 6. GAM Splines with `mgcv` – Simple → Complex\n\nGAM smooths are written `s(x)` and estimated with penalized splines. The **edf** (effective degrees of freedom) in the summary tells you the smooth’s complexity (larger edf ⇒ wigglier function).\n\n### 6A. Univariate GAM: `Sale_Price ~ s(Garage_Area)`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngam1 <- gam(Sale_Price ~ s(Garage_Area, k=9), data=train, method=\"REML\")\nsummary(gam1)  # inspect edf and significance\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFamily: gaussian \nLink function: identity \n\nFormula:\nSale_Price ~ s(Garage_Area, k = 9)\n\nParametric coefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   180897       1292     140   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nApproximate significance of smooth terms:\n                 edf Ref.df     F p-value    \ns(Garage_Area) 7.078  7.719 217.1  <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nR-sq.(adj) =   0.45   Deviance explained = 45.2%\n-REML =  25418  Scale est. = 3.4232e+09  n = 2051\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(gam1, pages=1, shade=TRUE, scheme=1, scale=0)\n```\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n### 6B. Two-smooth Additive GAM: `s(Garage_Area) + s(Gr_Liv_Area)`\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngam2 <- gam(Sale_Price ~ s(Garage_Area, k=9) + s(Gr_Liv_Area, k=9), data=train, method=\"REML\")\nsummary(gam2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFamily: gaussian \nLink function: identity \n\nFormula:\nSale_Price ~ s(Garage_Area, k = 9) + s(Gr_Liv_Area, k = 9)\n\nParametric coefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   180897       1026   176.2   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nApproximate significance of smooth terms:\n                 edf Ref.df     F p-value    \ns(Garage_Area) 6.446  7.293 103.3  <2e-16 ***\ns(Gr_Liv_Area) 7.585  7.941 152.6  <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nR-sq.(adj) =  0.653   Deviance explained = 65.5%\n-REML =  24949  Scale est. = 2.1608e+09  n = 2051\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(gam2, pages=1, shade=TRUE, scheme=1, scale=0)\n```\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n### 6C. Full Multivariate GAM (selected smooths + factors)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngam3 <- gam(Sale_Price ~ \n              s(Garage_Area, k=9) + \n              s(Gr_Liv_Area, k=9) + \n              s(Year_Built, k=7) +\n              s(Lot_Area, k=7) +\n              Bedroom_AbvGr + Mo_Sold + \n              Street + Central_Air + \n              First_Flr_SF + Second_Flr_SF + \n              Full_Bath + Half_Bath + \n              Fireplaces + TotRms_AbvGrd,\n            data=train, method=\"REML\")\nsummary(gam3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFamily: gaussian \nLink function: identity \n\nFormula:\nSale_Price ~ s(Garage_Area, k = 9) + s(Gr_Liv_Area, k = 9) + \n    s(Year_Built, k = 7) + s(Lot_Area, k = 7) + Bedroom_AbvGr + \n    Mo_Sold + Street + Central_Air + First_Flr_SF + Second_Flr_SF + \n    Full_Bath + Half_Bath + Fireplaces + TotRms_AbvGrd\n\nParametric coefficients:\n               Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   -21237.92   30106.84  -0.705   0.4806    \nBedroom_AbvGr -10350.20    1382.38  -7.487 1.05e-13 ***\nMo_Sold         -409.12     270.24  -1.514   0.1302    \nStreetPave     30589.21   13486.61   2.268   0.0234 *  \nCentral_AirY   17189.68    3366.03   5.107 3.59e-07 ***\nFirst_Flr_SF     140.27      17.44   8.044 1.47e-15 ***\nSecond_Flr_SF    101.93      17.36   5.871 5.06e-09 ***\nFull_Bath      -4548.94    2211.69  -2.057   0.0398 *  \nHalf_Bath       2355.98    2175.40   1.083   0.2789    \nFireplaces     13066.61    1371.59   9.527  < 2e-16 ***\nTotRms_AbvGrd  -1640.87     948.67  -1.730   0.0838 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nApproximate significance of smooth terms:\n                 edf Ref.df      F p-value    \ns(Garage_Area) 7.067  7.712  24.96  <2e-16 ***\ns(Gr_Liv_Area) 7.899  7.996  46.44  <2e-16 ***\ns(Year_Built)  5.255  5.764 128.05  <2e-16 ***\ns(Lot_Area)    5.465  5.883  16.44  <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nR-sq.(adj) =  0.827   Deviance explained =   83%\n-REML =  24167  Scale est. = 1.0786e+09  n = 2051\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(gam3, pages=1, shade=TRUE, scheme=1, scale=0)\n```\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n**Interpreting GAM splines:**  \nA smooth `s(x)` shows how the expected outcome varies with `x` *holding other terms constant*. The edf indicates complexity; wide confidence bands suggest greater uncertainty in those regions.\n\n---\n\n## 7. Model Comparison (R², RMSE, MSE)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Helper for R^2 on test\nrsq <- function(y, yhat) {\n  1 - sum((y - yhat)^2) / sum((y - mean(y))^2)\n}\n\n# Predictions\np_piece <- predict(m_seg, newdata=test)\np_mars  <- predict(mars3, newdata=test)   # final MARS with interactions\np_gam   <- predict(gam3, newdata=test)    # full multivariate GAM\n\n# Metrics\ntbl <- tibble(\n  Model = c(\"Piecewise (segmented)\", \"MARS (degree=2)\", \"GAM splines (mgcv full)\"),\n  RMSE  = c(rmse(test$Sale_Price, p_piece),\n            rmse(test$Sale_Price, p_mars),\n            rmse(test$Sale_Price, p_gam)),\n  MSE   = c(mse(test$Sale_Price, p_piece),\n            mse(test$Sale_Price, p_mars),\n            mse(test$Sale_Price, p_gam)),\n  R2    = c(rsq(test$Sale_Price, p_piece),\n            rsq(test$Sale_Price, p_mars),\n            rsq(test$Sale_Price, p_gam))\n) |> arrange(desc(R2))\n\ntbl\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 4\n  Model                     RMSE         MSE    R2\n  <chr>                    <dbl>       <dbl> <dbl>\n1 MARS (degree=2)         33028. 1090840972. 0.839\n2 GAM splines (mgcv full) 36796. 1353918715. 0.800\n3 Piecewise (segmented)   59034. 3484963067. 0.484\n```\n\n\n:::\n:::\n\n\n---\n\n## 8. Final Plot: Predicted vs Actual (Test Set)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_df <- bind_rows(\n  tibble(Model=\"Piecewise (segmented)\", Actual=test$Sale_Price, Pred=p_piece),\n  tibble(Model=\"MARS (degree=2)\", Actual=test$Sale_Price, Pred=p_mars),\n  tibble(Model=\"GAM splines (mgcv full)\", Actual=test$Sale_Price, Pred=p_gam)\n)\n\nggplot(plot_df, aes(Actual, Pred, color=Model)) +\n  geom_point(alpha=.35) +\n  geom_abline(intercept=0, slope=1, linetype=\"dashed\") +\n  labs(title=\"Predicted vs Actual (Test Set)\", y=\"Predicted Sale_Price\") +\n  coord_equal()\n```\n\n::: {.cell-output-display}\n![](generalized-additive-models-r_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n---\n\n## 9. How to Explain\n\n- **Piecewise**: “There’s a threshold where the effect changes.” Simple story, limited flexibility.  \n- **MARS**: “The model finds breakpoints and sometimes *when* they matter (interactions).” Explain `h(x-c)` as *extra slope after c*.  \n- **GAM (splines)**: “We model smooth curves for key variables; edf shows wiggliness. More edf ⇒ more flexibility.”  \n- **Tradeoff**: More flexibility usually improves error (RMSE/MSE) and R², but reduce interpretability. Validate with cross‑validation and keep the story aligned with business intuition.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}